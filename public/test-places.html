<!DOCTYPE html>
<html>
<head>
    <title>Google Places API Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        .result { background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .error { background: #ffe6e6; border: 1px solid #ff9999; }
        .success { background: #e6ffe6; border: 1px solid #99ff99; }
        input { width: 100%; padding: 10px; margin: 10px 0; box-sizing: border-box; }
        button { padding: 10px 20px; background: #007cba; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #005a87; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Google Places API Test</h1>
        <p>Testing Google Places Autocomplete for Nigerian addresses</p>
        
        <input type="text" id="addressInput" placeholder="Try: Shoprite Ikeja" />
        <button onclick="testAutocomplete()">Test Autocomplete</button>
        
        <div id="results"></div>
    </div>

    <script>
        const API_KEY = 'AIzaSyDPWtEX75mkFeui4yBfIWEnOpso-32_dZk';
        let autocompleteService;
        let placesService;

        function initMap() {
            console.log('Initializing Google Places...');
            
            if (window.google && window.google.maps && window.google.maps.places) {
                autocompleteService = new google.maps.places.AutocompleteService();
                
                // Create a dummy div for PlacesService
                const dummyDiv = document.createElement('div');
                placesService = new google.maps.places.PlacesService(dummyDiv);
                
                document.getElementById('results').innerHTML = '<div class="result success">Google Places API loaded successfully!</div>';
                console.log('Google Places initialized successfully');
            } else {
                document.getElementById('results').innerHTML = '<div class="result error">Failed to load Google Places API</div>';
                console.error('Google Places API not available');
            }
        }

        function testAutocomplete() {
            const input = document.getElementById('addressInput').value;
            const resultsDiv = document.getElementById('results');
            
            if (!input || input.length < 3) {
                resultsDiv.innerHTML = '<div class="result error">Please enter at least 3 characters</div>';
                return;
            }

            if (!autocompleteService) {
                resultsDiv.innerHTML = '<div class="result error">Google Places API not initialized</div>';
                return;
            }

            resultsDiv.innerHTML = '<div class="result">Searching...</div>';

            // Test multiple request configurations
            const requests = [
                {
                    name: 'Primary (establishments + geocode)',
                    config: {
                        input: input,
                        componentRestrictions: { country: 'ng' },
                        types: ['establishment', 'geocode'],
                        language: 'en'
                    }
                },
                {
                    name: 'Fallback (no type restrictions)',
                    config: {
                        input: input,
                        componentRestrictions: { country: 'ng' },
                        language: 'en'
                    }
                },
                {
                    name: 'Address only',
                    config: {
                        input: input,
                        componentRestrictions: { country: 'ng' },
                        types: ['address'],
                        language: 'en'
                    }
                }
            ];

            let completedRequests = 0;
            let allResults = [];

            requests.forEach((request, index) => {
                console.log(`Testing ${request.name}:`, request.config);
                
                autocompleteService.getPlacePredictions(
                    request.config,
                    (predictions, status) => {
                        completedRequests++;
                        
                        console.log(`${request.name} result:`, { predictions, status, count: predictions?.length });
                        
                        allResults.push({
                            name: request.name,
                            status: status,
                            count: predictions ? predictions.length : 0,
                            predictions: predictions || []
                        });

                        if (completedRequests === requests.length) {
                            displayResults(allResults);
                        }
                    }
                );
            });
        }

        function displayResults(results) {
            const resultsDiv = document.getElementById('results');
            let html = '<h3>Test Results:</h3>';

            results.forEach(result => {
                const statusClass = result.status === 'OK' ? 'success' : 'error';
                html += `
                    <div class="result ${statusClass}">
                        <h4>${result.name}</h4>
                        <p><strong>Status:</strong> ${result.status}</p>
                        <p><strong>Results found:</strong> ${result.count}</p>
                `;

                if (result.predictions.length > 0) {
                    html += '<p><strong>Sample results:</strong></p><ul>';
                    result.predictions.slice(0, 3).forEach(prediction => {
                        html += `<li>${prediction.description}</li>`;
                    });
                    html += '</ul>';
                }

                html += '</div>';
            });

            resultsDiv.innerHTML = html;
        }

        // Handle API load errors
        window.gm_authFailure = function() {
            document.getElementById('results').innerHTML = '<div class="result error">Google Maps API authentication failed. Check your API key.</div>';
        };
    </script>

    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDPWtEX75mkFeui4yBfIWEnOpso-32_dZk&libraries=places&callback=initMap">
    </script>
</body>
</html>